<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Frameset//EN""http://www.w3.org/TR/REC-html40/frameset.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc on Mon Jul 28 14:36:56 EDT 2008 -->
<TITLE>
BlackBerry Java SDK 7.0 API Reference: Overview
</TITLE>
<LINK REL ="stylesheet" TYPE="text/css" HREF="stylesheet.css" TITLE="Style">

<script type="text/javascript">
<!--
// switchMenu - Expand or collapse a code sample div. Takes two arguments:
// divSample, the id of the div to expand, divList
function switchMenu(divSample, sourceLink) {
	var el = document.getElementById(divSample).style;
	if (el.display == 'none') {
		el.display = 'block';
		sourceLink.className = 'explink_minus';
	} else {
		el.display = 'none';
		sourceLink.className = 'explink_plus';
	}
}

// collapseAll - Collapses all expandable divs and adds the + graphic automatically when the page loads.
// This is done so that users who do not have JS enabled can still see the code samples.
function collapseAll() {
	// Collapse all expandable divs
	var divsOnPage = document.getElementsByTagName('div');
	for (var x = 0; x < divsOnPage.length; x++) {
		if (divsOnPage[x].id.substr(0,3) == "UI_") {
			divsOnPage[x].style.display = 'none';
		}
	}

	// Change all the expand/collapse links to explink_plus, to show a plus sign beside it
	var linksOnPage = document.getElementsByTagName('a');
	for (var y = 0; y < linksOnPage.length; y++) {
		if (linksOnPage[y].className == "explink") {
			linksOnPage[y].className = "explink_plus";
		}
	}
}
//-->
</script>
</HEAD>
<BODY BGCOLOR="white" onLoad="collapseAll();">

<!-- ========== START OF NAVBAR ========== -->
<A NAME="navbar_top"><!-- --></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A> </TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev">    <FONT CLASS="NavBarFont1Rev">Package</FONT> </TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev">    <FONT CLASS="NavBarFont1Rev">Class</FONT> </TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="overview-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A> </TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A> </TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="index-files/index-1.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A> </TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A> </TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
 PREV 
 NEXT</FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="index.html" TARGET="_top"><B>FRAMES</B></A>   
 <A HREF="Messaging-summary.html" TARGET="_top"><B>NO FRAMES</B></A></FONT></TD>
</TR>
</TABLE>
<!-- =========== END OF NAVBAR =========== -->
<HR>
<FORM action="https://www.blackberry.com/DocsFeedback/" method="GET" target="_new">
<INPUT type="hidden" name="title" value="API Reference">
<INPUT type="hidden" name="source" value="External">

<INPUT type="hidden" name="version" value="7.0.0">
<INPUT type="hidden" name="classname" value="Messaging overview">
<INPUT type="submit" value="Submit Feedback" /></FORM>

<BR>


<h1 align="center">Messaging<a name="MG_TOP"></a> </h1>

<h2>Overview</h2>
<p>This document describes how to use the messaging capabilities of the BlackBerry&reg;  device. It includes the following sections:
<ul>
  <li><a href="#MG_1">Email messages</a> </li>
  <li><a href="#MG_2">Application messages</a></li>
  <li><a href="#MG_3">SMS and MMS messages</a></li>
</ul>
<h2>Email messages<a name="MG_1"></a></h2>
<p>Packages: <a href="net/rim/blackberry/api/mail/package-summary.html">net.rim.blackberry.api.mail</a>, <a href="net/rim/blackberry/api/mail/event/package-summary.html">net.rim.blackberry.api.mail.event</a></p>
<h3>Creating and sending email messages</h3>
<p>To create and send email messages, you must set the default <span class="style2"><a href="net/rim/blackberry/api/mail/Session.html">Session</a></span>, retrieve a <span class="style2"><a href="net/rim/blackberry/api/mail/Store.html">Store</a></span> instance, create the email message and store it in a retrieved sent folder, and set up and send the email message.</p>
<p><a class="explink" onClick="switchMenu('UI_1', this);">Click  for code sample: Create and send a text email message</a></p>
<div id="UI_1" class="codesample">

<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td>
      <pre>//Get the Store from the default mail Session. 
Store store = Session.getDefaultInstance().getStore(); 
 
//retrieve the sent folder 
Folder[] folders = store.list(Folder.SENT); 
Folder sentfolder = folders[0]; 
 
//create a new message and store it in the sent folder 
Message msg = new Message(sentfolder); 
Address recipients[] = new Address[1]; 
 
try 
{ 
    recipients[0]= new Address("user@company.com", "user"); 
   
    //add the recipient list to the message 
    msg.addRecipients(Message.RecipientType.TO, recipients); 
   
    //set a subject for the message 
    msg.setSubject(&ldquo;Test email&rdquo;); 
   
    //sets the body of the message 
    msg.setContent("This is a test email from my BlackBerry device"); 
   
    //sets priority 
    msg.setPriority(Message.Priority.HIGH); 
   
    //send the message 
    Transport.send(msg); 
} 
 
catch (Exception me) 
{ 
    System.err.printIn(me); 
}</pre></td>
</tr>
</table>
</div>

<h3>Accessing HTML email messages</h3>
<p>BlackBerry devices can receive an email message  that contains HTML, plain text, or both. To access HTML content, BlackBerry devices must be running BlackBerry&reg; Device Software 4.5 or later and must be associated with BlackBerry&reg; Enterprise Server 4.1 SP6 or later or BlackBerry&reg; Internet Service 2.5 or later. You cannot send HTML email messages from a BlackBerry device. </p>
<p>You can access the body of an email message in both HTML and plain text format. You can access the HTML body by using the  <span class="style2"><a href="net/rim/blackberry/api/mail/MimeBodyPart.html">MimeBodyPart</a></span> class, and you can access the plain text body by using the  <span class="style2"><a href="net/rim/blackberry/api/mail/TextBodyPart.html">TextBodyPart</a></span> class,  both of which are packaged inside a <span class="style2"><a href="net/rim/blackberry/api/mail/Multipart.html">Multipart</a></span> object. </p>
<p> The hierarchy of an email message can vary based on the content within the email message. Factors include whether the email body is in HTML or plain text format (or both), whether the email message contains a type of attachment supported by the BlackBerry Attachment Service, or whether the email message contains a type of attachment that is not supported by the BlackBerry Attachment Service.  Because the hierarchy of an email message can vary, your application should be able to adapt to any hierarchy structure.</p>
<p><a class="explink" onClick="switchMenu('UI_3', this);">Click  for code sample: Extract the HTML and plain text content from an email message</a></p>
<div id="UI_3" class="codesample">
<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td>
      <pre><span id="support">public class MessageViewScreen extends MainScreen
{
    private boolean _hasSupportedAttachment;
    private boolean _hasUnsupportedAttachment;
    private String _plainTextMessage = "";
    private String _htmlMessage = "";

    public MessageViewScreen(Message message)
    {
        super();
        findEmailBody(message.getContent());
 
        if( _hasSupportedAttachment )
        {
            this.add(new LabelField("This message has a supported attachment."));
        } 
        else if( _hasUnsupportedAttachment )
        {
            this.add(new LabelField("This message has an unsupported attachment type."));
        } 
        else
        {
            this.add(new LabelField("This message has no attachment."));
        }
 
        this.add(new SeparatorField());
        this.add(new EditField("Plain Text Message Body: ", _plainTextMessage));
        this.add(new SeparatorField());
        this.add(new EditField("HTML Message Body: ", _htmlMessage));
    } 
    //This method reads an email message to find the email body
    private void findEmailBody(Object obj)
    {
        //Reset the attachment flags.
        _hasSupportedAttachment = false;
        _hasUnsupportedAttachment = false;
 
        if(obj instanceof Multipart)
        {
            Multipart mp = (Multipart)obj;  
            //Extract all of the parts within the Multipart message. 
            for(int count=0; count < mp.getCount(); ++count)
            {                  
                findEmailBody(mp.getBodyPart(count));
            }
        } 
        else if (obj instanceof TextBodyPart)
        {
            //This message only has a text body.
            TextBodyPart tbp = (TextBodyPart)obj;
            readEmailBody(tbp);
        }
        else if (obj instanceof MimeBodyPart)
        { 
            MimeBodyPart mbp = (MimeBodyPart)obj;  
            if (mbp.getContentType().indexOf(ContentType.TYPE_TEXT_HTML_STRING) != -1)
            {   
                //The message has no attachments.
                //Read the email body, which may contain a 
                //TexBodyPart, MimeBodyPart or both.
                readEmailBody(mbp);  
            }
            else if  (mbp.getContentType().equals(ContentType.TYPE_MULTIPART_MIXED_STRING)  
                    || mbp.getContentType().equals(ContentType.TYPE_MULTIPART_ALTERNATIVE_STRING))  
            {  
                //The message has attachments or we are at the 
                //top level of the message. Dig deeper to find the body.
                //Extract all of the parts within the MimeBodyPart message.
                findEmailBody(mbp.getContent());  
            }
        }  
        else if (obj instanceof SupportedAttachmentPart)  
        { 
            //This is a supported attachment.  
            _hasSupportedAttachment = true;  
        }  
        else if (obj instanceof UnsupportedAttachmentPart)
        {  
            //This is an unsupported attachment.  
            _hasUnsupportedAttachment = true;
        }
    }
    private void readEmailBody(TextBodyPart tbp)
    {  
        //This is the plain text body.  
        _plainTextMessage = (String)tbp.getContent();
 
        //Determine if all of the text body part is present.  
        if (tbp.hasMore() && !tbp.moreRequestSent())
        {  
            //It does, request more of the message.  
            try
            {  
                Transport.more((BodyPart)tbp, true);
                Status.show("Requesting more of the plain text message body. " +
                            "Reopen the screen to view it once more has been received."); 
            }  
            catch (Exception ex)  
            {  
                Dialog.alert("Exception: " + ex.toString());  
            }  
        }  
    }
 
    //Displays the HTML or plain text body of the email message.  
    private void readEmailBody(MimeBodyPart mbp)  
    {  
        //Extract the content of the message.
        //Note that getContent() and getContentType() can both return null.
        //A production application should check for null in the following two statements.
        Object obj = mbp.getContent();
        String mimeType = mbp.getContentType();
        String body = null;
        //Determine if the data returned is a String or a byte array. 
        //If the BlackBerry is able to convert the HTML content  
        //into a String, then a String should be returned. If  
        //the encoding is not supported, a byte array is returned  
        //to allow your application to work with the raw data.
        if (obj instanceof String)  
        {  
            body = (String) obj;  
        }  
        else if (obj instanceof byte[])  
        {
            body = new String((byte[])obj);  
        }
        if (mimeType.indexOf(ContentType.TYPE_TEXT_PLAIN_STRING)  != -1)  
        {  
            //This is the plain text body.  
            _plainTextMessage = body;
 
            //Determine if all of the text body part is present.  
            if (mbp.hasMore() && !mbp.moreRequestSent())
            {  
                //It does, request more of the message.  
                try  
                {  
                    Transport.more((BodyPart)mbp, true);
                    Status.show("Requesting more of the plain text  message body. " +
                    		"Reopen the screen to view it once more has been received.");  
                }  
                catch (Exception ex)  
                {  
                    Dialog.alert("Exception: " + ex.toString());  
                }  
            }  
        }  
        else if (mimeType.indexOf(ContentType.TYPE_TEXT_HTML_STRING)  != -1)  
        {  
            //This is the HTML body part of the message.  
            _htmlMessage = body;   
            //Determine if all of the HTML body part is present. 
            if (mbp.hasMore() && !mbp.moreRequestSent()) 
            { 
                //It does, request more of the message.  
                try 
                {
                    Transport.more((BodyPart)mbp, true);
                    Status.show("Requesting more of the HTML message  body." +
                    		"Reopen the screen to view it once more has been received.");
                } 
                catch (Exception ex) 
                { 
                    Dialog.alert("Exception: " + ex.toString()); 
                }
            }
        }
    }
}</span></pre></td>
</tr>
</table>
</div>

<h3>Handling email attachments</h3>
<p>The BlackBerry device supports  different types of formatted files as email attachments. For a list of supported attachments, see the information about the BlackBerry Attachment Service in the BlackBerry&reg; Enterprise Server <em>Feature and Technical Overview</em> at  <a href="http://www.blackberry.com/go/serverdocs" target="_blank">www.blackberry.com/go/serverdocs</a> and the BlackBerry&reg; Internet Service <em>Feature and Technical Overview</em> at <a href="http://www.blackberry.com/go/docs/smartphone_users" target="_blank">www.blackberry.com/go/docs/smartphone_users</a>. </p>
<h4>Creating and sending attachments </h4>
<p>To send an email message with an attachment, create the <a href="net/rim/blackberry/api/mail/Multipart.html" class="style2">Multipart</a> object, create and add the attachment file to this object, and structure and send the email message.</p>
<p><a class="explink" onClick="switchMenu('UI_4', this);">Click  for code sample: Create and send an email message with an attachment</a></p>
<div id="UI_4" class="codesample">
<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td>
      <pre>//create a multipart 
Multipart mp = new Multipart(); 
  
//data for the content of the file 
String fileData = "&lt;html&gt;just a simple test&lt;/html&gt;"; 
String messageData = "Mail Attachment Demo"; 
 
//create the file 
SupportedAttachmentPart sap = new
    SupportedAttachmentPart(mp,"text/html","file.html", fileData.getBytes()); 
 
TextBodyPart tbp = new TextBodyPart(mp,messageData); 
   
//add the message and file to the multipart 
mp.addBodyPart(tbp); 
mp.addBodyPart(sap); 
   
//create a message in the sent items folder 
Folder[] folders = Session.getDefaultInstance().getStore().list(Folder.SENT); 
   
Message message = new Message(folders[0]); 
   
//add recipients to the message and send 
try 
{ 
    Address toAdd = new Address("email@company.com","my email"); 
    Address[] toAdds = new Address[1]; 
    toAdds[0] = toAdd; 
    message.addRecipients(Message.RecipientType.TO,toAdds); 
    message.setContent(mp); 
    Transport.send(message); 
} 
  
catch (Exception e) 
{ 
    Dialog.inform(e.toString()); 
}</pre></td>
</tr>
</table>
</div>

<h4>Downloading attachments </h4>
<p>BlackBerry device users can use menu items to manage email attachments manually. To automatically download attachments in email messages in the background when messages arrive in the message list, you can use the <a href="net/rim/blackberry/api/mail/DownloadProgressListener.html">DownloadProgressListener</a> interface and the <a href="net/rim/blackberry/api/mail/AttachmentDownloadManager.html">AttachmentDownloadManager</a> class.</p>
<p><strong>Note: </strong>The BlackBerry Attachment Service receives all attachments before third-party attachment handlers. For more information about the BlackBerry Attachment Service, see the <em>BlackBerry Enterprise
  Server Administration Guide</em>.</p>
<p>For an example of how to download attachments, see the AttachmentDemo sample application provided with the BlackBerry&reg; Java&reg; Development Environment. </p>

<h3>Creating and sending  PIN messages</h3>
<p>Each BlackBerry device has a unique PIN (personal identification number) and supports PIN-to-PIN  messaging sent using the messages application. To allow your application to create and send PIN messages from a BlackBerry device,  you must set the default <span class="style2"><a href="net/rim/blackberry/api/mail/Session.html">Session</a></span>, retrieve a <span class="style2"><a href="net/rim/blackberry/api/mail/Store.html">Store</a></span> instance, set the destination PIN address, create the PIN message and store it in a retrieved sent folder, and set up and send the PIN message.</p>
<p><a class="explink" onClick="switchMenu('UI_2', this);">Click for code sample: Create and send a text PIN message</a></p>
<div id="UI_2" class="codesample">

<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td>
      <pre>
Store store = Session.getDefaultInstance().getStore();
 
//retrieve the sent folder
Folder[] folders = store.list(Folder.SENT);
Folder sentfolder = folders[0];
  
//create a new message and store it in the sent folder
Message msg = new Message(sentfolder);
PINAddress[] recipients = new PINAddress[1];
  
try
{
    //create a pin address with destination address of 20000001
    recipients[0]= new PINAddress("20000001", "Robert");
}
 
catch (AddressException ae)
{
    System.err.println(ae);
}
 
try
{
    //add the recipient list to the message
    msg.addRecipients(Message.RecipientType.TO, recipients);
 
    //set a subject for the message
    msg.setSubject("Test pin message");
  
    //sets the body of the message
    msg.setContent("This is a test pin message from my BlackBerry device");
  
    //send the message
    Transport.send(msg);
}
 
catch (MessagingException me)
{
    System.err.println(me);
}</pre></td>
</tr>
</table>
</div>



<h2>Application messages <a name="MG_2"></a> <a href="#MG_TOP" class="backtotop">[back to top]</a></h2>
<p>Packages: <a href="net.rim.blackberry.api.mail.DownloadProgressListener.html">net.rim.blackberry.api.messagelist</a></p>
<p>You can use the <span class="style2">messagelist</span> package to create application messages. An <span class="style2">ApplicationMessage</span> is a custom message that appears in the messages application and invokes your application when the user opens it or chooses a menu item that you provide for the message. For more information, see the <a href="App-Integration-summary.html#AI_MessagesApp">Application Integration</a> overview.</p>

<h2>SMS and MMS messages<a name="MG_3"></a> <a href="#MG_TOP" class="backtotop">[back to top] </a></h2>
<p>Packages: <a href="javax/wireless/messaging/package-summary.html">javax.wireless.messaging</a>, <a href="net/rim/blackberry/api/sms/package-summary.html">net.rim.blackberry.api.sms</a>, <a href="net/rim/blackberry/api/mms/package-summary.html">net.rim.blackberry.api.mms</a> </p>
<p>You can create applications that  send and receive SMS (Short Message Service) messages or MMS (Multimedia Messaging Service) messages. SMS support is provided through <a href="http://jcp.org/en/jsr/detail?id=120" target="_blank">JSR 120</a>. MMS support is provided through <a href="http://jcp.org/en/jsr/detail?id=205" target="_blank">JSR 205</a>. You can perform the following actions:
<ul>
  <li><a href="#MG_3A">Sending and receiving SMS messages</a></li>
  <li><a href="#MG_3B">Sending and receiving MMS messages</a></li>
  <li><a href="#MG_3C">Configuring listeners for outgoing and sent messages</a></li>
</ul>
<h3>Sending and receiving SMS messages<a name="MG_3A"></a></h3>
<p>You can send SMS messages by using the <a href="javax/wireless/messaging/package-summary.html">javax.wireless.messaging</a> APIs and the BlackBerry <a href="net/rim/blackberry/api/invoke/package-summary.html">Invoke</a> API. </p>
<p><strong>Note:</strong> You cannot send SMS messages directly from a BlackBerry device that operates on a CDMA network. For detailed information and workarounds for this issue, see the <a href="http://supportforums.blackberry.com/" target="_blank">BlackBerry Support Community Forums</a>. </p>
<p><a class="explink" onClick="switchMenu('UI_6', this);">Click  for code sample: Create and send an SMS message</a></p>
<div id="UI_6" class="codesample">
<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td><pre>MessageConnection mc = (MessageConnection)Connector.open(_openString);
TextMessage m = (TextMessage)mc.newMessage(MessageConnection.TEXT_MESSAGE); 
m.setAddress( "sms://5558888" );
m.setPayloadText( "An SMS Message for you" ); 
Invoke.invokeApplication( Invoke.APP_TYPE_MESSAGES, MessageArguments( m ) );</pre></td>
    </tr>
  </table>
</div>

<p>To receive SMS messages  using BlackBerry Java SDK 4.6.0 or later, use the <a href="javax/wireless/messaging/MessageListener.html" class="style2">MessageListener</a> interface. If you are using an earlier version of the BlackBerry Java SDK, use the <a href="javax/wireless/messaging/MessageConnection.html" class="style2">MessageConnection</a> interface. </p>
<p><strong>Note: </strong>If you want specific SMS messages to be saved in an SMS message folder, you must specify the folder location using <a href="net/rim/blackberry/api/invoke/MessageArguments.html" class="style2">MessageArguments</a> when the SMS message is received by the BlackBerry device. Applications cannot access SMS messages that are stored on the BlackBerry device. </p>
<p>To listen for incoming SMS messages that appear  in the message list, set the port number argument in <a href="javax/microedition/io/Connector.html#open(java.lang.String)" class="style2">Connector.open()</a> to <span class="style2">0</span> &ndash; <span class="style2">Connector.open("sms://:0")</span>. </p>
<p><a class="explink" onClick="switchMenu('UI_8', this);">Click for code sample: Receive an SMS message using the MessageListener interface</a></p>
<div id="UI_8" class="codesample">
<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td><pre>MessageConnection _mc = (MessageConnection)Connector.open("sms://:0");  
_mc.setMessageListener(this); 
   
... 
   
public void notifyIncomingMessage(MessageConnection conn)  
{ 
    Message m = _mc.receive(); 
    String address = m.getAddress(); 
    String msg = null; 
    if ( m instanceof TextMessage ) 
    { 
        TextMessage tm = (TextMessage)m; 
        msg = tm.getPayloadText(); 
    } 
    else  if (m instance of BinaryMessage) 
    { 
        StringBuffer buf = new StringBuffer(); 
        byte[] data = ((BinaryMessage) m).getPayloadData(); 
   
        // convert Binary Data to Text 
        msg = new String(data, "UTF-8"); 
     } 
     else 
     {
         System.out.println("Invalid Message Format"); 
         System.out.println("Received SMS text from  " + address + " : " + msg); 
     }
}</pre>
      </td>
    </tr>
  </table>
</div>




<p><a class="explink" onClick="switchMenu('UI_7', this);">Click for code sample: Receive an SMS message using the MessageConnection interface</a></p>
<div id="UI_7" class="codesample">
<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td><pre>MessageConnection _mc = (MessageConnection)Connector.open("sms://:0");  
   
for(;;) 
{ 
    Message m = _mc.receive(); 
    String address = m.getAddress(); 
    String msg = null; 
 
    if ( m instanceof TextMessage ) 
    { 
        TextMessage tm = (TextMessage)m; 
        msg = tm.getPayloadText(); 
    } 
    else if (m instance of BinaryMessage) 
    { 
        StringBuffer buf = new StringBuffer(); 
        byte[] data = ((BinaryMessage) m).getPayloadData(); 
        // convert Binary Data to Text 
        msg = new String(data, "UTF-8");    
    } 
    else 
    {
        System.out.println("Invalid Message Format"); 
        System.out.println("Received SMS text from " + address  + " : " + msg); 
    }
}</pre>
      </td>
    </tr>
  </table>
</div>



<h3>Sending and receiving MMS messages<a name="MG_3B"></a></h3>
<p>MMS messages consist of an MMS header and body. The MMS header consists of address, priority, subject, and delivery information. The MMS body contains the multimedia attachment portion. </p>
<p>Sending MMS messages is similar to sending SMS messages, except that you must pass in the <a href="javax/wireless/messaging/MessageConnection.html#MULTIPART_MESSAGE" class="style2">MULTIPART_MESSAGE</a> constant when creating the <a href="javax/wireless/messaging/MessageConnection.html" class="style2">MessageConnection</a> object. </p>
<p><a class="explink" onClick="switchMenu('UI_9', this);">Click for code sample: Create and send an MMS message with text and a .jpeg file attachment</a></p>
<div id="UI_9" class="codesample">
<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td><pre>MessageConnection mc = (MessageConnection)Connector.open(_openString);
MultipartMessage mulMsg = 
    (MultipartMessage)msgConn.newMessage(MessageConnection.MULTIPART_MESSAGE);
mulMsg.setAddress(address);
mulMsg.setAddress("mms://mail@mail.com");
mulMsg.setSubject("JAVA MMS TEST");

String mimeType = "text/plain"; 
String encoding = "UTF-8";
String text = "Hello from my java midlet";
byte[] contents = text.getBytes(encoding);
MessagePart msgPart = new MessagePart(contents, 0, contents.length, 
    mimeType, "id1", "contentLocation", encoding);
mulMsg.addMessagePart(msgPart); 

InputStream is = getClass().getResourceAsStream("image.jpg");
mimeType = "image/jpeg"; 
contents = new byte[is.available()];
is.read(contents); 
msgPart = new MessagePart(contents, 0, contents.length, 
    mimeType, "id2", "bg.jpg", null);
mulMsg.addMessagePart(msgPart);

Invoke.invokeApplication( Invoke.APP_TYPE_MESSAGES, MessageArguments( m ) );</pre></td>
    </tr>
  </table>
</div>

<p>To receive MMS messages when using BlackBerry Java SDK 4.6.0 or later, use the <a href="javax/wireless/messaging/MessageListener.html" class="style2">MessageListener</a> interface. If you are using an  earlier version of the BlackBerry Java SDK, use the <a href="javax/wireless/messaging/MessageConnection.html" class="style2">MessageConnection</a> interface.</p>
<p>To listen for incoming MMS messages that appear  in the message list, set the selected <a href="javax/microedition/io/Connector.html#open(java.lang.String)" class="style2">Connector.open()</a> application ID to 0.  </p>
<p><a class="explink" onClick="switchMenu('UI_10', this);">Click for code sample: Receive an MMS message using the MessageListener interface</a></p>
<div id="UI_10" class="codesample">
<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td><pre>MessageConnection _mc = 
    (MessageConnection)Connector.open("mms://+123456789:applicationID");  
_mc.setMessageListener(this); 
   
... 
   
public void notifyIncomingMessage(MessageConnection conn)  
{ 
    Message m = _mc.receive(); 
    String address = m.getAddress(); 
    String msg = null; 
    if ( m instanceof TextMessage ) 
    { 
        MultipartMessage mpm = (MultipartMessage)msg;
        String subject = mpm.getSubject();
        String date = mpm.getTimestamp().toString();
        MessagePart[] parts = mpm.getMessageParts(); 
    } 
    else  if (parts != null)
    {
        for (int i = 0; i &lt; parts.length; i++)
        {
            MessagePart mp = parts[i];
            String mimeType = mp.getMIMEType();
            String contentLocation = mp.getContentLocation();
            byte[] ba = mp.getContent();
            try
            {
                Image image = Image.createImage(ba, 0, ba.length);
            } 
        } 
    } 
    else 
    {
        System.out.println("Invalid Message Format"); 
        System.out.println("Received MMS text from  " + address + " : " + msg); 
    }
}</pre>      </td>
    </tr>
  </table>
</div>
<p><a class="explink" onClick="switchMenu('UI_11', this);">Click for code sample: Receive an MMS message using the MessageConnection interface</a></p>
<div id="UI_11" class="codesample">
<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td><pre>public MessagePart[] receiveTextAndImageMMS() throws IOException 
{
 
    final Connection connection;
    
    try 
    {
        connection = Connector.open("mms://:5555");
    } 
    catch (Exception e) 
    {
        throw new IOException("unable to open connection:" + e.getMessage());
    }
 
    try 
    {
        final MessageConnection con = (MessageConnection) connection;
        final MultipartMessage message;
        try 
        {
            message = (MultipartMessage) con.receive();
        } 
        catch (IOException e) 
        {
            throw new IOException("unable to receive MMS message: " + e.getMessage());
        }
 
        final MessagePart[] parts = message.getMessageParts();
        if (parts == null || parts.length == 0) 
        {
            throw new IOException("received MMS message has no parts");
        }
 
        MessagePart textPart = null;
        MessagePart imagePart = null;
 
        for (int i = 0; i &lt; parts.length; i++) 
        {
            final MessagePart part = parts[i];
            if (part == null) 
            {
                continue; // should never happen, but just to be safe
            }
            final String mimeType = part.getMIMEType();
            if (mimeType == null) {
                continue; // should never happen, but just to be safe
            }
 
            if (mimeType.equals("text/plain")) 
            {
                textPart = part;
            } 
            else if (mimeType.startsWith("image/")) 
           {
               imagePart = part;
           }
        }
 
        if (textPart == null && imagePart == null) 
        {
           throw new IOException("no text or image parts found in received MMS message");
        } 
        else if (textPart == null) 
        {
            throw new IOException("no text parts found in received MMS message");
        } 
        else if (imagePart == null) 
        {
            throw new IOException("no image parts found in received MMS message");
        }
 
        return new MessagePart[] { textPart, imagePart };
       } 
       finally 
       {
           connection.close();
    }
}</pre>
      </td>
    </tr>
  </table>
</div>

<h3>Configuring listeners for outgoing and sent messages<a name="MG_3C"></a></h3>
    <p>In addition to providing notification to applications when messages are received (using the <a href="javax/wireless/messaging/MessageListener.html" class="style2">MessageListener</a> interface), you can also configure application notification for outgoing and sent SMS messages and MMS messages. For SMS messages, you can configure your application to track sent SMS messages by passing an instance of a class that implements the <a href="net/rim/blackberry/api/sms/OutboundMessageListener.html" class="style2">OutboundMessageListener</a> interface when invoking <a href="javax/wireless/messaging/MessageConnection.html#setMessageListener(javax.wireless.messaging.MessageListener)" class="style2">MessageConnection.setMessageListener()</a>. Notification using this interface occurs only after the message is sent successfully. If the send operation fails, the application is not notified. </p>
    <p>For example: </p>
<div class="codesample">
<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td><pre>...
public void run()
{
    try 
    {
         //closed by the stop() method
         _mc = (MessageConnection)Connector.open("sms://:0");
               
         if (_mc != null)
         {
              _mc.setMessageListener(new OutboundSMSListener());
         }
    }
    catch
    {
        ...
    }
}</pre></td>
    </tr>
  </table>
</div>
    <p>To notify your application about SMS  messages before they are sent, pass an instance of a class that implements  the <a href="net/rim/blackberry/api/sms/SendListener.html" class="style2">SendListener</a>  interface when invoking <a href="net/rim/blackberry/api/sms/SMS.html#addSendListener(net.rim.blackberry.api.sms.SendListener)" class="style2">addSendListener(SendListener listener)</a>. You can also use this interface to modify the contents of the SMS message before sending and to prevent messages from being sent if <a href="net/rim/blackberry/api/sms/SendListener.html#sendMessage(javax.wireless.messaging.Message)" class="style2">SendListener.sendMessage(Message message)</a> returns <span class="style2">false</span>. </p>

    <p><a class="explink" onClick="switchMenu('UI_13', this);">Click for code sample: Configure an SMS SendListener </a></p>
    <div id="UI_13" class="codesample">
<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td>
<pre><span id="support">import javax.wireless.messaging.Message;
import javax.wireless.messaging.TextMessage;
import net.rim.device.api.system.Application;
import net.rim.blackberry.api.sms.SMS;
import net.rim.blackberry.api.sms.SendListener;

public class SMSSendListenerDemo extends Application 
{

    public static void main(String[] args) 
    {
        final SMSSendListenerDemo app = new SMSSendListenerDemo();
        app.invokeLater(new SetupRunnable());
        app.enterEventDispatcher();
    }

    private static class MySMSSendListener implements SendListener 
    {
        public boolean sendMessage(Message message) 
        {
            if (message instanceof TextMessage) 
            {
                String address = ((TextMessage) message).getAddress();
                if (address != null && address.endsWith("5551212")) 
                {
                    // do not allow SMS to be sent to 5551212
                    return false;
                }
            }
            return true;
        }
    }

    private static class SetupRunnable implements Runnable 
    {
        public void run() 
        {
            SendListener listener = new MySMSSendListener();
            SMS.addSendListener(listener);
        }
    }
}</span></pre>
  </td>
    </tr>
  </table>
</div>


    <p><strong>Note:</strong> When an SMS message is marked for sending, the message in the message list is marked with PENDING status. The <span class="style2">SendListener</span> is notified at this time. If <span class="style2">SendListener</span> does not send the message, the SMS message in the message list is marked with a red X, and your application is notified with the failure reason.</p>
    <p>To set up notification for MMS messages before they are sent,  pass an instance of a class that implements  the <a href="net/rim/blackberry/api/mms/SendListener.html" class="style2">SendListener</a> interface when invoking <a href="net/rim/blackberry/api/mms/MMS.html#addSendListener(net.rim.blackberry.api.mms.SendListener)" class="style2">addSendListener(SendListener listener)</a>. You can also prevent messages from being sent if <a href="net/rim/blackberry/api/mms/SendListener.html#sendMessage(javax.wireless.messaging.Message)" class="style2">SendListener.sendMessage(Message message)</a> returns <span class="style2">false</span>. Unlike  SMS messages, you cannot use this interface to modify the contents of an MMS message before it is sent.</p>


    <p><a class="explink" onClick="switchMenu('UI_12', this);">Click for code sample: Configure an MMS SendListener </a></p>
    <div id="UI_12" class="codesample">
<table cellspacing="0" class="codesample" width="75%">
    <tr>
      <td>
<pre><span id="support">import javax.wireless.messaging.Message;
import javax.wireless.messaging.MultipartMessage;
import net.rim.device.api.system.Application;
import net.rim.blackberry.api.mms.MMS;
import net.rim.blackberry.api.mms.SendListener;

public class MMSSendListenerDemo extends Application 
{

    public static void main(String[] args) 
    {
        final MMSSendListenerDemo app = new MMSSendListenerDemo();
        app.invokeLater(new SetupRunnable());
        app.enterEventDispatcher();
    }

    private static class MyMMSSendListener implements SendListener 
    {
        public boolean sendMessage(Message message) 
        {
            if (message instanceof MultipartMessage) 
            {
                MultipartMessage mmsMessage = ((MultipartMessage) message);
                String[] addresses = mmsMessage.getAddresses("to");
                int addressesLength = (addresses == null) ? 0 : addresses.length;
                for (int i = 0; i < addressesLength; i++) 
                {
                    final String address = addresses[i];
                    if (address != null && address.endsWith("5551212")) 
                    {
                        // do not allow MMS to be sent to 5551212
                        return false;
                    }
                }
            }
            return true;
        }
    }

    private static class SetupRunnable implements Runnable 
    {
        public void run() 
        {
            final SendListener listener = new MyMMSSendListener();
            MMS.addSendListener(listener);
        }
    }
}</span></pre>
  </td>
    </tr>
  </table>
</div>


<HR>
<div id="legalnotice">
<table cellspacing="0" cellpading="0" width="100%" style="border:none;">
<tr>
<td style="border:none;">
<font size=-1>
<P>Copyright 1999-2011 Research In Motion Limited. 295 Phillip Street, Waterloo, Ontario, Canada, N2L 3W8. All Rights Reserved.<br>
Java is a trademark of Oracle America, Inc. in the US and other countries.</p>
</font>
</td>
<td style="text-align:right; border:none;">
<font size=-1><br>
<a href="http://www.blackberry.com/legal" target="_blank">Legal</a>
</font>
</td>
</tr>
</table>
 </div>
</BODY>
</HTML>
